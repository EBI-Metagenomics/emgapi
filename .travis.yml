sudo: required
language: python

python:
  - '2.7'
  - '3.5'
  - '3.6'

services:
  - docker
  - mongodb

before_install:
  - pip install flake8 pycodestyle pep8-naming
  - python setup.py sdist

install:
  # We do this conditionally because it saves us some downloading if the
  # version is the same.
  - if [[ "$TRAVIS_PYTHON_VERSION" == "2.7" ]]; then
      wget https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh -O miniconda.sh;
    else
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
    fi
  - SRCDIR=$(pwd) docker/run.sh install

before_script:
  - docker --version
  # travis by default comes with MySQL 5.5
  - sudo service mysql stop
  - docker run --rm --name mysql -p 3306:3306 -e MYSQL_ALLOW_EMPTY_PASSWORD=yes -d mysql:5.6
  # optional redis
  # - docker run --rm --name redis -p 6379:6379 -d redis
  - flake8 --version
  - flake8 -v .
  - mkdir -p ~/.yamjam && cp travis/config.yaml ~/.yamjam/

script:
  - SRCDIR=$(pwd) docker/run.sh travis
after_script:
  - docker stop mysql #redis

notifications:
  slack:
    secure: BB0Wp1bqoeM2c6RHGx8H0/i0TCiaOjxf8akJxBeGf19emKCZ9ln083Sfw3WwLiomwpTmxAuZdo0b4dCTwfrCgp9Nao8g77g3b9knUBE7FqOkTcGijjU8UhK6P0o+x3zGkZ5gH6Wr+RUrshaRvPmgADOQVMrFfs+phMREk51Hf4O1wvuRvRxyB/lggxcgiGojtfns5vAGaotjqHQvTY9BvakhfWNxIiITverLncLnU/23zsoTJWES61Wln8T4Im0nLxLeVhIJirsUWcPPkK3Hf+01AozcJNWaZoRNJRBDA8PBf5qXJLOanhIkZBf2H/F4rwE/ESMcft61Jaumec3EHbx9RkZxaqHQihYxW//8AIMjOjBhx3QeZnFLQqCzrfWw8jYmhsHNX/qDNYSy68WM+i7Ea+RrGc9AlC+1r9GrmyD+LhvNATI8F2icmvzWPCDCnEy1l2S7PC/Cg1xaGxU/BqNglxiNhrpJZcNx27h599+2i9BcMJgByZ87XrNCflTtLc9wvJvxStKdqadjblnC7/xAlNLhl0VadVyjb4DzaRevc734KXdkkni5A95dAtxl6OY6qger/Qy76ETM3YuJISqPpgLgL8SraZbGc/E/Ay4p4Kqtmq2pQMOHUzMiqoKbuI1iJac/jaLLgFI/NLehwLXJXr4J4Tact2OkAO5iBiw=
